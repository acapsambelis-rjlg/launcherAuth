@model RJLG.LauncherAuthServer.Models.CustomerAccount

@{
    ViewBag.Title = Model.CustomerName;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<main>
    <h2>@Model.CustomerName</h2>
    <div>
        <hr />
        <table width="100%">
            <tr>
                <td width="50%" style="padding:10px; vertical-align:top;">
                    <dl class="row">
                        <dd>
                            <h5>Contact Information</h5>
                            <form method="post" action="~/Customers/UpdateContact" style="display:flex; flex-direction:column; gap:1rem;">
                                <input type="hidden" name="ID" value="@Model.ID" />
                                <table style="width:100%;">
                                    <tr>
                                        <td style="padding-right:1rem;">
                                            <label for="contactName">Contact Name:</label>
                                        </td>
                                        <td>
                                            <input type="text" id="contactName" name="ContactName" value="@Model.ContactName" style="width: 100%;" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding-right:1rem;">
                                            <label for="contactEmail">Contact Email:</label>
                                        </td>
                                        <td>
                                            <input type="email" id="contactEmail" name="ContactEmail" value="@Model.ContactEmail" style="width: 100%;" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding-right:1rem;">
                                            <label for="timezone">Timezone:</label>
                                        </td>
                                        <td>
                                            <input type="text" id="timezone" name="Timezone" value="@Model.Timezone" style="width: 100%;" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding-right:1rem; vertical-align:top;">
                                            <label for="notes">Notes:</label>
                                        </td>
                                        <td>
                                            <textarea id="notes" name="Notes" rows="4" maxlength="2000" style="width: 100%;">@Model.Notes</textarea>
                                        </td>
                                    </tr>
                                </table>
                                <button type="submit">Save Contact Info</button>
                            </form>
                        </dd>
                    </dl>
                </td>
                <td width="50%" style="padding:10px; vertical-align:top;">
                    <dl class="row">
                        <dd class="col-sm-10">
                            <h5>Current Version</h5>
                            <form method="post" action="~/Customers/UpdateVersion" style="display:inline;">
                                <input type="hidden" name="id" value="@Model.ID" />
                                <select name="currentVersion">
                                    @foreach (RJLG.LauncherAuthServer.Models.IntelliSEMVersion version in ViewBag.AvailableVersions)
                                    {
                                        <option value="@version.Version" @(version.Version.Equals(Model.CurrentVersion) ? "selected" : "")>@version.Version</option>
                                    }
                                </select>
                                <button type="submit">Save</button>
                            </form>
                        </dd>
                    </dl>
                    <div id="addKeyModal" class="modal-overlay">
                        <div class="modal-content">
                            <button class="modal-close" type="button" id="closeAddKeyModal">&times;</button>
                            <form method="post" action="~/Keys/Save" class="entry-form">
                                @Html.Partial("../Keys/_CreateKey")
                                <input type="hidden" name="customerId" value="@Model.ID" />
                            </form>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <h5 style="margin: 0;">Login Keys</h5>
                        <button id="showAddKeyModal" type="button">Add Key</button>
                    </div>
                    @if (Model.LoginKeys != null && Model.LoginKeys.Count > 0)
                    {
                        <table class="table table-striped table-bordered table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Key</th>
                                    <th scope="col">Active Users</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var key in Model.LoginKeys)
                                {
                                    <tr>
                                        <td style="word-break: break-all;">@key.Key</td>
                                        <td>@key.AssociatedUsersCount</td>
                                        <td>
                                            <form method="post" action="~/Keys/Remove" style="display:inline;">
                                                <input type="hidden" name="keyId" value="@key.ID" />
                                                <input type="hidden" name="customerId" value="@Model.ID" />
                                                <input type="hidden" name="returnUrl" value="~/Customers/Details?customerId=@Model.ID" />
                                                <button type="submit">Remove</button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <p>No keys saved</p>
                    }
                </td>
            </tr>
        </table>
    </div>
</main>
<script>
    document.getElementById('showAddKeyModal').onclick = function () {
        document.getElementById('addKeyModal').style.display = 'flex';
    };
    document.getElementById('closeAddKeyModal').onclick = function () {
        document.getElementById('addKeyModal').style.display = 'none';
    };
    // Optional: close modal when clicking outside content
    document.getElementById('addKeyModal').onclick = function (e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    };
</script>